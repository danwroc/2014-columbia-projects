YUI.add("flickr-photos-comments-getList-fetcher",function(e){"use strict";function t(e){var t={photo_id:e.id,offset:e.offset||0,limit:e.limit||4,sort:e.sort||"date-posted-desc",extras:"icon_urls",expand_bbml:!0,use_text_for_links:1};return e.photosInCommentsEnabled&&(t.bbml_need_all_photo_sizes=!0,t.primary_photo_longest_dimension=240),t}function n(t){var n=t[0],r=t[1],i=t[2],s=t[3],o=[],u=typeof n.comments.comment=="undefined"?0:n.comments.comment.length,a,f,l,c,h;return u>0&&e.Array.each(n.comments.comment,function(t,n,r){a={id:t.author,username:t.authorname,realname:t.realname,pathAlias:t.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(t.iconurls),isAdFree:t.isAdFree,isPro:t.ispro},a.pathAlias=t.pathAlias,l=s.exists(t.author)?s.proxy(t.author):s.add(a),f={id:t.id,author:l,date:t.datecreate,permalink:t.permalink,content:t.content,contentRaw:t.rawComment.content},o.push(i.exists(t.id)?i.proxy(t.id):i.add(f))}),r.exists(n.comments.photoId)?(c=r.proxy(n.comments.photoId).getValue("comments").getList(),h=c.concat(o),r.proxy(n.comments.photoId).setValue("comments",h)):r.add({id:n.comments.photoId,comments:o}),o}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photos.comments.getList",this._processParams(t)),n.getModelRegistry("photo-comments-models"),n.getModelRegistry("comment-models"),n.getModelRegistry("person-models")).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-comments-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photos-comments-getList"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-comments-models","comment-models","person-models"]});
YUI.add("comments-view",function(e){e.namespace("Views")[this.name]=e.Base.create("comments-view",e.FlickrView,[],{initializer:function(e){return this.photoId=e.photoId,this.appContext.flipper.isFlipped("comments-chronological")?(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:3,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:200):(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:4,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:10),this.currentlyShowingCount=0,this.initiallyShowingCount=0,this.postingComment=!1,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModelRegistry("comment-models").then(function(e){t.commentModelsRegistry=e})),n.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(e){t.photoEngagement=e;var n=t.photoEngagement.getValue("commentCount");n>=t.initiallyShowingMaximum?(t.initiallyShowingCount=t.initiallyShowingMaximum,t.currentlyShowingCount=t.initiallyShowingMaximum):(t.initiallyShowingCount=n,t.currentlyShowingCount=n)}).then(function(){return t.appContext.getModel("photo-comments-models",t.photoId)}).then(function(e){t.photoComments=e;if(t.photoEngagement.getValue("commentCount")>0)return t.photoComments.getValue("comments").getRange({offset:0,limit:t.initiallyShowingCount,photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){t.set("comments",e)});t.set("comments",[])})),n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.photoModel=e})),this.appContext.getViewer().signedIn&&n.push(t.appContext.getModel("person-models",t.appContext.getViewer().nsid).then(function(e){t.person=e})),e.batch.apply(null,n)},buildContainer:function(){var e,t=this.person?this.person.toJSON():null,n=this.get("comments"),r=this.appContext.flipper.isFlipped("comments-chronological")?"chronological":"reverse-chronological",i=this.calculateShowMoreCount(),s=i===1?"1 more comment":i+" more commments",o;this.appContext.flipper.isFlipped("comments-chronological")&&(n=n.reverse());for(o=0;o<n.length;o++)n[o]=n[o].toJSON?n[o].toJSON():n[o],n[o].isSignedIn=this.appContext.getViewer().signedIn,n[o].isLoggedInUsersPhoto=this.isLoggedInUsersPhoto(),n[o].canCommentBeDeleted=this.canCommentBeDeleted(n[o].author.nsid),n[o].commentBelongsToViewer=this.commentBelongsToViewer(n[o].author.nsid),n[o].enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),n[o].canComment=this.photoModel.getValue("canComment");return e=this.templates("comments-view")({user:t,comments:n,showMore:this.calculateShowMoreCount()>0?!0:!1,showMoreCount:this.calculateShowMoreCount(),showMoreString:s,canComment:this.photoModel.getValue("canComment"),tutorialMode:!0,commentsOrder:r,commentsChronological:this.appContext.flipper.isFlipped("comments-chronological"),photosInCommentsClass:this.appContext.flipper.isFlipped("photos-in-comments")?"photosInComments":""}),this.setContainerHTML(e),this.retinafyCommentImages(),this},activate:function(){var t=this;return t.get("container").one(".comments-more")&&t.registerEventHandler(t.get("container").one(".comments-more a").on("click",t.handleMoreCommentsClick.bind(t))),e.use("transition",function(e){t.attachEvents({"keydown:comment":t.handleCommentKeyDown.bind(t),"blur:comment":t.handleCommentBlur.bind(t),"focus:comment":t.handleCommentFocus.bind(t),".comment-reply click:reply":t.handleReplyClick.bind(t),".comment-delete click:delete":t.handleDeleteClick.bind(t),".comment-edit click:edit":t.handleEditClick.bind(t)})}),this},postComment:function(t){var n=this,r,i,s,o,u=this.photoEngagement.getValue("commentCount");if(e.Lang.trim(t)===""){this.onError("An empty comment box? That won't work!"),this.postingComment=!1;return}e.rapidTracker.beacon(this.name,"commentPosted"),this.commentModelsRegistry.remoteCreate({photoId:this.photoId,commentText:t,photosInCommentsEnabled:this.appContext.flipper.isFlipped("photos-in-comments")}).then(function(t){i=t.toJSON(),i.isSignedIn=n.appContext.getViewer().signedIn,i.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),i.enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),i.canCommentBeDeleted=!0,i.commentBelongsToViewer=!0,i.canComment=!0,n.get("container").one("textarea").set("value",""),r=e.Node.create(n.templates("comment")(i)).setStyle("opacity","0.1"),u>0?n.appContext.flipper.isFlipped("comments-chronological")?n.get("container").one(".comments").append(r).one("li:last-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):n.get("container").one(".comments").prepend(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):(n.get("container").one(".comments-holder").append("<ul class='comments'></ul>"),n.get("container").one(".comments").append(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"})),n.retinafyCommentImages(),s=n.photoComments.getValue("comments").prependToList(t),o=n.photoEngagement.getValue("commentCount")+1,n.photoEngagement.setValue("commentCount",o),n.currentlyShowingCount++,n.postingComment=!1},function(e){n.onError("We couldn't post your comment."),n.postingComment=!1}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})},handleMoreCommentsClick:function(e){e.preventDefault();var t=this,n=this.get("container"),r="",i=n.one(".comments-more"),s;i.one("a").set("text","Loading"),i.addClass("is-loading"),this.appContext.getModel("photo-comments-models",this.photoId).then(function(e){e.getValue("comments").getRange({offset:t.currentlyShowingCount,limit:t.calculateShowMoreCount(),photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){var o;t.appContext.flipper.isFlipped("comments-chronological")&&(e=e.reverse());for(o=0;o<e.length;o++)s=e[o].toJSON(),s.isSignedIn=t.appContext.getViewer
().signedIn,s.isLoggedInUsersPhoto=t.isLoggedInUsersPhoto(),s.canCommentBeDeleted=t.canCommentBeDeleted(s.author.nsid),s.commentBelongsToViewer=t.commentBelongsToViewer(s.author.nsid),s.enabledEditableComments=t.appContext.flipper.isFlipped("enable-editable-comments"),s.canComment=t.photoModel.getValue("canComment"),r+=t.templates("comment")(s);t.appContext.flipper.isFlipped("comments-chronological")?n.one(".comments").prepend(r):n.one(".comments").append(r),t.retinafyCommentImages(),t.currentlyShowingCount=t.currentlyShowingCount+e.length,t.calculateShowMoreCount()>0?(i.one("a").set("text",t.calculateShowMoreCount()+" more"),i.removeClass("is-loading")):i.remove()},function(e){t.onError("We couldn't get more comments.")}).then(null,function(e){t.appContext.error(e.message),t.appContext.error(e.stack)})})},calculateShowMoreCount:function(){var e=this.photoEngagement.getValue("commentCount");return e>this.currentlyShowingCount+this.showMoreMaximum?this.showMoreMaximum:e<=this.currentlyShowingCount+this.showMoreMaximum?e-this.currentlyShowingCount:0},isLoggedInUsersPhoto:function(){return this.photoModel.getValue("owner").getValue("nsid")===this.appContext.getViewer().nsid},canCommentBeDeleted:function(e){return e===this.appContext.getViewer().nsid||this.isLoggedInUsersPhoto()?!0:!1},commentBelongsToViewer:function(e){return e===this.appContext.getViewer().nsid?!0:!1},retinafyCommentImages:function(){if(this.appContext.getCookie("density")>1){var t=e.all(".comments li .comment-content a[data-photo-size-m]");t.each(function(e){e.one("img").setAttribute("src",e.getAttribute("data-photo-size-m")),e.removeAttribute("data-photo-size-m")})}},handleCommentKeyDown:function(e){e.charCode===13&&!e.altKey&&!e.shiftKey&&!this.postingComment&&(e.preventDefault(),this.postingComment=!0,this.postComment(this.get("container").one("textarea").get("value")))},handleCommentBlur:function(e){var t=this.get("container").one("textarea");t.set("placeholder",t.getData("notutorial"))},handleCommentFocus:function(e){var t=this.get("container").one("textarea");t.set("placeholder",t.getData("tutorial"))},handleReplyClick:function(e){e.preventDefault();var t=this.get("container").one("textarea"),n=t.get("value"),r="",i=t.getDOMNode(),s;n.length>0&&(r+=n+" "),r+="[http://www.flickr.com/photos/"+e.target.getAttribute("data-pathalias")+"] ",i.setSelectionRange?(i.focus(),i.setSelectionRange(i.value.length,i.value.length)):i.createTextRange&&(s=i.createTextRange(),s.collapse(!0),s.moveEnd("character",i.value.length),s.moveStart("character",i.value.length),s.select()),t.focus(),t.set("value",r),i.scrollTop=i.scrollHeight},handleEditClick:function(t){t.preventDefault();var n=this,r=t.target.ancestor(".comment"),i=t.target.getAttribute("data-id"),s,o,u;if(r.one("textarea")){r.one("textarea").remove(),r.one(".comment-content").show();return}n.appContext.getModel("comment-models",i).then(function(t){r.one(".comment-content").hide(),n.appContext.flipper.isFlipped("photos-in-comments")?r.append("<textarea>"+t.getValue("contentRaw")+"</textarea>"):r.append("<textarea>"+t.getValue("content")+"</textarea>"),s=r.one("textarea"),s.select(),s.on("keydown",function(a){if(a.charCode===13&&!a.altKey&&!a.shiftKey&&!n.postingEditedComment){a.preventDefault();if(e.Lang.trim(s.get("value"))===""){n.onError("An empty comment box? That won't work!");return}n.postingEditedComment=!0,t.setValues({content:s.get("value")}),n.appContext.modelRegistries["comment-models"].remoteUpdate(i).then(function(i){i?u=i.toJSON():u=t.toJSON(),u.isSignedIn=n.appContext.getViewer().signedIn,u.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),u.enabledEditableComments=n.appContext.flipper.isFlipped("enable-editable-comments"),u.canCommentBeDeleted=!0,u.commentBelongsToViewer=!0,u.canComment=n.photoModel.getValue("canComment"),o=e.Node.create(n.templates("comment")(u)),r.replace(o),n.postingEditedComment=!1},function(e){n.postingEditedComment=!1,t.revertValue("content"),n.onError(e.message)})}})})},handleDeleteClick:function(t){t.preventDefault();var n=this,r,i=t.target.ancestor(".comment"),s=t.target.getAttribute("data-id"),o;r=e.Views.dialog.getNewInstance("dialog-cta",{attrs:{title:"Confirm Delete",useCancelButton:!0,confirmButtonText:"Yes, Delete It",cancelButtonText:"Cancel"},content:"Are you sure you want to delete this comment?",parent:this}),r.on("confirm",function(){this.appContext.modelRegistries["comment-models"].remoteDelete(s).then(function(){n.photoComments.getValue("comments").removeFromList(s),o=n.photoEngagement.getValue("commentCount")-1,n.photoEngagement.setValue("commentCount",o),n.currentlyShowingCount--,i.transition({easing:"ease-out",duration:.5,opacity:"0"},function(){i.remove(),o===0&&n.get("container").one(".comments").remove()})},function(e){n.onError("We couldn't delete your comment.")}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})}),r.show()},onError:function(t){var n=e.Views.dialog.getNewInstance("dialog-alert",{content:"Error! "+t,attrs:{level:"warning"},parent:this});n.show()}})},"@VERSION@",{requires:["dialog","flickr-view","moment","comments-css","hermes-template-comments","hermes-template-comment","hermes-template-comments-view"],optional:["photo-comments-models"]});
YUI.add("hermes-template-photo-charms",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+="\n		<button class='photo-charm-button' title='"+f((i=e.title,typeof i===a?i.apply(e):i))+"' data-charm-type='"+f((i=e.type,typeof i===a?i.apply(e):i))+"'>\n			<i class='hide-text'>",s={hash:{},data:t},r+=f((i=n.capitalize||e.capitalize,i?i.call(e,e.title,s):l.call(e,"capitalize",e.title,s)))+"</i>\n		</button>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+="<div class='photo-charms-bar'>\n	",o=n.each.call(t,t.buttons,{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(o||o===0)s+=o;return s+="\n	\n	<div class='photo-charm-indicator hide-text'>\u2191</div>\n</div>\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-exif-view"],t.showExif,u):l.call(t,"outlet",t["photo-charm-exif-view"],t.showExif,u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-contexts-view"],t.showContexts,u):l.call(t,"outlet",t["photo-charm-contexts-view"],t.showContexts,u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-tags-view"],t.showTags,u):l.call(t,"outlet",t["photo-charm-tags-view"],t.showTags,u)))+"\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-charms",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-charms-loading",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="',(o=n.className)?o=o.call(t,{hash:{},data:i}):(o=t.className,o=typeof o===a?o.apply(t):o),s+=f(o)+" photo-charm-panel-",(o=n.type)?o=o.call(t,{hash:{},data:i}):(o=t.type,o=typeof o===a?o.apply(t):o),s+=f(o)+' photo-charm-panel loading">\n	',u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t.loadingState,!1,u):l.call(t,"outlet",t.loadingState,!1,u)))+"\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-charms-loading",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-charms-view",function(e){var t="contexts",n="photoChm";e.namespace("Views")[this.name]=e.Base.create("photo-charms-view",e.FlickrView,[],{initializer:function(e){return this.currentCharm=this.appContext.getCookie(n)||t,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.appContext.flipper.isFlipped("tags-charm")||delete this.subviewConfig["photo-charm-tags-view"],this},subviewConfig:{"photo-charm-contexts-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["photo-charm-panel","photo-charm-panel-contexts"],disabled:function(){return this.currentCharm!=="contexts"}},"photo-charm-exif-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["photo-charm-panel","photo-charm-panel-exif"],disabled:function(){return this.currentCharm!=="exif"}},"photo-charm-tags-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["photo-charm-panel","photo-charm-panel-tags"],disabled:function(){return this.currentCharm!=="tags"}}},loadState:function(){return new e.AutoResolvingPromise},buildContainer:function(){var t=[{type:"exif",title:"Info"},{type:"contexts",title:"Also In"}],n,r,i,s,o,u=this;return this.appContext.flipper.isFlipped("tags-charm")&&t.push({type:"tags",title:"Tags"}),o=function(t,n){return u.templates("photo-charms-loading")({className:t,type:n,loadingState:u.templates(e.Balls())()})},r=this.subviews["photo-charm-contexts-view"]?this.subviews["photo-charm-contexts-view"].get("container"):o("photo-charm-contexts-view","contexts"),i=this.subviews["photo-charm-exif-view"]?this.subviews["photo-charm-exif-view"].get("container"):o("photo-charm-exif-view","exif"),s=this.subviews["photo-charm-tags-view"]?this.subviews["photo-charm-tags-view"].get("container"):o("photo-charm-tags-view","tags"),n=this.templates("photo-charms")({buttons:t,initialCharm:this.currentCharm,"photo-charm-contexts-view":r,"photo-charm-exif-view":i,"photo-charm-tags-view":s,showContexts:typeof this.subviews["photo-charm-contexts-view"]!="undefined",showTags:typeof this.subviews["photo-charm-tags-view"]!="undefined",showExif:typeof this.subviews["photo-charm-exif-view"]!="undefined"}),this.setContainerHTML(n),this},activate:function(){var t=this,n=t.get("container"),r,i,s=!0,o;return e.use("transition",function(e){t.registerEventHandler(n.on("click",t.handleCharmButtonClick,t))}),this.activateSubviews(),this.activateCharm(this.currentCharm),r=e.OverflowHelper.detectScrollbarSize(n),r>0&&(i=e.one("#content"),e.OverflowHelper.addFlowListener(i,"over",function(){(this.offsetWidth>this.clientWidth||this.offsetHeight>this.clientHeight)&&s&&(t.activateCharm(t.currentCharm),s=!1)},function(e){t.registerEventHandler(e)}),e.OverflowHelper.addFlowListener(i,"under",function(){this.offsetWidth===this.clientWidth&&!s&&(t.activateCharm(t.currentCharm),s=!0)},function(e){t.registerEventHandler(e)})),o=function(n){var r=n?"flickr:photo-page:focus_person_tag_entry":"flickr:photo-page:focus_tag_entry";return function(){t.get("container").one('[data-charm-type="tags"]')&&t.processCharmButtonClicked("tags",function(){setTimeout(function(){e.fire(r)},100)})}},this.attachKeyEvent("down:84",o),e.on("flickr:photo-page-open-add-tag",o(!1)),e.on("flickr:photo-page-open-add-people-tag",o(!0)),this},handleCharmButtonClick:function(e){var t=e.target,n,r;n=t.ancestor(".photo-charm-button",!0);if(!n)return;r=n.getAttribute("data-charm-type");if(!r)return;e.preventDefault(),this.processCharmButtonClicked(r)},processCharmButtonClicked:function(t,n){var r=this,i={exif:"photo-charm-exif-view",tags:"photo-charm-tags-view",contexts:"photo-charm-contexts-view"};this.currentCharm=t,this.subviews[i[this.currentCharm]]?typeof n=="function"&&n():this.defferedSubviewInstantiation(i[this.currentCharm],this._params).then(function(){typeof n=="function"&&n()}),this.get("container").one(".photo-charm-indicator").addClass("active"),e.rapidTracker.beacon(this.name,t+"CharmButtonClick"),this.activateCharm(t),setTimeout(function(){r.get("container").one(".photo-charm-indicator").removeClass("active")},1e3)},activateCharm:function(e){var t=this.get("container"),r,i,s;i=t.one(".photo-charm-indicator"),r=t.one("[data-charm-type = "+e+"]"),t.all(".photo-charm-panel").setStyle("display","none"),t.one(".photo-charm-panel-"+e)&&t.one(".photo-charm-panel-"+e).setStyle("display","block"),r&&(s=r.get("offsetLeft")+r.get("offsetWidth")/2-i.get("offsetWidth")/2,i.setStyles({left:s+"px",opacity:1})),this.appContext.setCookie({remove:!0,cookieName:n,path:"/photos/",cookieValue:e})}})},"@VERSION@",{requires:["flickr-view","photo-charms-css","hermes-template-photo-charms","overflow-helper","hermes-template-photo-charms-loading","html5-balls"],optional:[]});
YUI.add("photo-sidebar-view",function(e){e.namespace("Views")[this.name]=e.Base.create("photo-sidebar-view",e.FlickrView,[],{initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.closeUrl=e.closeUrl,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"photo-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,additionalViewClasses:["clear-float"]},"photo-stats-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"photo-sidebar-actions-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"comments-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"photo-charms-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"context-slider-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){return e.AutoResolvingPromise()},buildContainer:function(){var e;return e=this.templates("photo-sidebar")({"close-url":this.closeUrl,"attribution-view":this.subviews["attribution-view"].get("container"),"photo-title-desc-view":this.subviews["photo-title-desc-view"].get("container"),"photo-stats-view":this.subviews["photo-stats-view"].get("container"),"actions-view":this.subviews["photo-sidebar-actions-view"].get("container"),"comments-view":this.subviews["comments-view"].get("container"),"photo-charms-view":this.subviews["photo-charms-view"].get("container"),"context-slider-view":this.subviews["context-slider-view"].get("container")}),this.setContainerHTML(e),this},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-sidebar","photo-sidebar-css","url-helper"],optional:["attribution-view","photo-title-desc-view","photo-stats-view","photo-sidebar-actions-view","comments-view","photo-charms-view","photo-models","person-models"]});
YUI.add("hermes-template-head-meta",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function d(e,t){var n="";return n+='description="'+l(typeof e===f?e.apply(e):e)+'"',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this,p=n.blockHelperMissing;s+='<meta name="',(o=n.metaName)?o=o.call(t,{hash:{},data:i}):(o=t.metaName,o=typeof o===f?o.apply(t):o),s+=l(o)+'" content="',a={hash:{},data:i},s+=l((o=n.renderMetaInfo||t.renderMetaInfo,o?o.call(t,t.metaValue,a):c.call(t,"renderMetaInfo",t.metaValue,a)))+'" ',a={hash:{},inverse:h.noop,fn:h.program(1,d,i),data:i},(u=n.metaDescription)?u=u.call(t,a):(u=t.metaDescription,u=typeof u===f?u.apply(t):u),n.metaDescription||(u=p.call(t,u,a));if(u||u===0)s+=u;return s+=' data-dynamic="true">\n',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-meta",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-head-link",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i;return r+='id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}function p(e,t){var r="",i;return r+='rev="',(i=n.rev)?i=i.call(e,{hash:{},data:t}):(i=e.rev,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}function d(e,t){var r="",i;return r+='rel="',(i=n.rel)?i=i.call(e,{hash:{},data:t}):(i=e.rel,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}function v(e,t){var r="",i;return r+='type="',(i=n.type)?i=i.call(e,{hash:{},data:t}):(i=e.type,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}function m(e,t){var r="",i;return r+='href="',(i=n.href)?i=i.call(e,{hash:{},data:t}):(i=e.href,i=typeof i===a?i.apply(e):i),r+=f(i)+'"',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.helperMissing;s+="<link ",o=n["if"].call(t,t.id,{hash:{},inverse:l.noop,fn:l.program(1,h,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.rev,{hash:{},inverse:l.noop,fn:l.program(3,p,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.rel,{hash:{},inverse:l.noop,fn:l.program(5,d,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.type,{hash:{},inverse:l.noop,fn:l.program(7,v,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.href,{hash:{},inverse:l.noop,fn:l.program(9,m,i),data:i});if(o||o===0)s+=o;return s+=' data-dynamic="true" data-dynamic-added-by="',u={hash:{},data:i},s+=f((o=n.obfuscateInternals||t.obfuscateInternals,o?o.call(t,t.addedBy,u):c.call(t,"obfuscateInternals",t.addedBy,u)))+'">',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-link",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-global-nav",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){return'\n		<li role="menuitem" class="gn-signup">\n			<a data-track="gnSignupClick" class="gn-title" href="/signup">Sign Up</a>\n		</li>\n	'}function p(e,t){var n="",r;return n+='\n		<li role="menuitem" data-context="you">\n			<a data-track="gnYouMainClick" class="gn-title you" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.photostream),typeof r===a?r.apply(e):r))+'" aria-haspopup="true">You</a>\n			<ul class="gn-submenu" role="menu">\n				<li class="menuitem"><a data-track="gnYouPhotostreamClick" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.photostream),typeof r===a?r.apply(e):r))+'">Photostream</a></li>\n				<li class="menuitem"><a data-track="gnYouSetsClick" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.sets),typeof r===a?r.apply(e):r))+'">Sets</a></li>\n				<li class="menuitem"><a data-track="gnYouMapClick" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.map),typeof r===a?r.apply(e):r))+'">Map</a></li>\n				<li class="menuitem"><a data-track="gnYouFavoritesClick" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.favorites),typeof r===a?r.apply(e):r))+'">Favorites</a></li>\n				<li class="menuitem"><a data-track="gnYouGalleriesClick" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.galleries),typeof r===a?r.apply(e):r))+'">Galleries</a></li>\n				<li class="menuitem"><a data-track="gnYouRecentActivityClick" href="/activity">Recent Activity</a></li>\n				<li class="menuitem"><a data-track="gnYouStatsClick" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.stats),typeof r===a?r.apply(e):r))+'">Stats</a></li>\n				<li class="menuitem"><a data-track="gnYouOrganizeClick" href="/photos/organize">Organize</a></li>\n				<li class="menuitem"><a data-track="gnYouCreationsClick" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.creations),typeof r===a?r.apply(e):r))+'">Creations</a></li>\n			</ul>\n		</li>\n	',n}function d(e,t){var n="",r;return n+='\n		<li class="toplink">\n			<a data-track="gnYouMainClick" class="gn-link" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.photostream),typeof r===a?r.apply(e):r))+'"><span>Your Photostream</span></a>\n		</li>\n	',n}function v(e,t){var n="",r;return n+='\n		<li role="menuitem" data-context="contacts">\n			<a data-track="gnContactsMainClick" class="gn-title contacts" href="/photos/friends" aria-haspopup="true">Following</a>\n			<ul class="gn-submenu" role="menu">\n				<li class="menuitem"><a data-track="gnContactsRecentPhotosClick" href="/photos/friends">Photos from</a></li>\n				<li class="menuitem"><a data-track="gnContactsPhotosOfContactsClick" href="/photosof/contacts">Photos of</a></li>\n				<li class="menuitem"><a data-track="gnContactsContactListClick" href="'+f((r=(r=(r=e.viewer,r==null||r===!1?r:r.urls),r==null||r===!1?r:r.contacts),typeof r===a?r.apply(e):r))+'">List</a></li>\n				<li class="menuitem"><a data-track="gnContactsAddContactsClick" href="/import/people">Find Friends</a></li>\n			</ul>\n		</li>\n	',n}function m(e,t){return'\n		<li role="menuitem" data-context="communities">\n			<a data-track="gnCommunitiesMainClick" class="gn-title communities" href="/groups" aria-haspopup="true">Communities</a>\n			<ul class="gn-submenu" role="menu">\n				<li class="menuitem"><a data-track="gnCommunitiesGroupsListClick" href="/groups">Groups List</a></li>\n				<li class="menuitem"><a data-track="gnCommunitiesRecentDiscussionsClick" href="/recent.gne">Recent Discussions</a></li>\n				<li class="menuitem"><a data-track="gnCommunitiesSearchGroupsClick" href="/search/groups">Search Groups</a></li>\n				<li class="menuitem"><a data-track="gnCommunitiesCreateAGroupClick" href="/groups_create.gne">Create a Group</a></li>\n			</ul>\n		</li>\n	'}function g(e,t){return'\n		<li role="menuitem" data-context="explore">\n			<a data-track="gnExploreMainClick" class="gn-title explore" href="/explore" aria-haspopup="true">Explore</a>\n			<ul class="gn-submenu" role="menu">\n				<li role="menuitem"><a data-track="gnExploreRecentPhotosClick" href="/explore">Recent Photos</a></li>\n				<li role="menuitem"><a data-track="gnExploreTheCommonsClick" href="/commons">The Commons</a></li>\n				<li role="menuitem"><a data-track="gnExploreGettyCollectionClick" href="/gettyimages">Getty Collection</a></li>\n				<li role="menuitem"><a data-track="gnExploreGalleriesClick" href="/galleries">Galleries</a></li>\n				<li role="menuitem"><a data-track="gnExploreWorldMapClick" href="/map">World Map</a></li>\n				<li role="menuitem"><a data-track="gnExploreAppGardenClick" href="/services">App Garden</a></li>\n				<li role="menuitem"><a data-track="gnExploreCameraFinderClick" href="/cameras">Camera Finder</a></li>\n				<li role="menuitem"><a data-track="gnExploreFlickrBlogClick" href="https://blog.flickr.net/">Flickr Blog</a></li>\n			</ul>\n		</li>\n	'}function y(e,t){return'\n		<li role="menuitem" class="gn-upload">\n			<a data-track="gnUploadMain" class="gn-title" href="/upload">Upload</a>\n		</li>\n	'}function b(e,t){return'\n		<li role="menuitem">\n			<form action="/search/" method="get" role="search">\n				<input type="text" name="q" value="" id="gn-search-field" autocomplete="off" aria-label="Search" role="textbox">\n				<input type="submit" data-track="gnSearchSearchIcon" class="search-icon" tabindex="-1" aria-label="Search" role="button">\n			</form>\n		</li>\n	'}function w(e,t){var r="",i,s;return r+="\n		",s={hash:{},data:t},r+=f((i=n.outlet||e.outlet,i?i.call(e,e["account-menu-view"],s):l.call(e,"outlet",e["account-menu-view"],s)))+"\n	",r}function E(e,t){return'\n		<li role="menuitem" class="gn-upload">\n			<a data-track="gnSignin" class="gn-title" href="/signin">Sign In</a>\n		</li>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this
.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+='<a href="/" class="main-logo" data-track="gnLogoClick" title="Flickr logo. If you click it, you\'ll go home"></a>\n\n<ul class="nav-menu" role="menubar">\n	',u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.signup_link),{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(u||u===0)s+=u;s+="\n\n	",u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.you_menu),{hash:{},inverse:c.noop,fn:c.program(3,p,i),data:i});if(u||u===0)s+=u;s+="\n\n	",u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.you_link),{hash:{},inverse:c.noop,fn:c.program(5,d,i),data:i});if(u||u===0)s+=u;s+="\n\n	",u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.contacts_menu),{hash:{},inverse:c.noop,fn:c.program(7,v,i),data:i});if(u||u===0)s+=u;s+="\n\n	",u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.groups_menu),{hash:{},inverse:c.noop,fn:c.program(9,m,i),data:i});if(u||u===0)s+=u;s+="\n	\n	",u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.explore_menu),{hash:{},inverse:c.noop,fn:c.program(11,g,i),data:i});if(u||u===0)s+=u;s+="\n	\n	",u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.upload_link),{hash:{},inverse:c.noop,fn:c.program(13,y,i),data:i});if(u||u===0)s+=u;s+='\n</ul>\n\n<ul class="gn-tools">\n	',u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.nav_selecta),{hash:{},inverse:c.noop,fn:c.program(15,b,i),data:i});if(u||u===0)s+=u;s+="\n\n	",u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.account_menu),{hash:{},inverse:c.noop,fn:c.program(17,w,i),data:i});if(u||u===0)s+=u;s+="\n	\n	",u=n["if"].call(t,(o=t.elements,o==null||o===!1?o:o.signin_link),{hash:{},inverse:c.noop,fn:c.program(19,E,i),data:i});if(u||u===0)s+=u;return s+="\n</ul>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/global-nav",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("global-nav-view",function(e){e.namespace("Views")[this.name]=e.Base.create("global-nav-view",e.FlickrView,[],{initializer:function(e){return this.get("container").html===""&&this.setContainerHTML(""),this.elementStates=this.setElementStates(e),this},subviewConfig:{},loadState:function(){var t=this,n=this.appContext.getViewer();return n.signedIn?this.appContext.getModel("person-models",n.nsid).then(function(e){t.set("viewer",e)}):new e.AutoResolvingPromise},buildContainer:function(){var t={};return this.get("viewer")&&(t=e.merge(this.get("viewer").toJSON(),{urls:this.generateViewerUrls(this.get("viewer"))})),this.setContainerHTML(this.templates("global-nav")({viewer:t,elements:this.elementStates})),this},activate:function(){return this.attachKeyEvent("up:83",this.focusSearch.bind(this)),this},focusSearch:function(e){this.get("container").one("#gn-search-field").focus()},setElementStates:function(e){var t={small_logo:!1,you_link:!1,you_menu:!1,contacts_menu:!1,groups_menu:!1,explore_menu:!1,upload_link:!1,account_menu:!1,nav_selecta:!1,tour_link:!1,signup_link:!1,signin_link:!1,pro_upsell:!1,chronic_link:!1,editr_tour_link:!1,use_uh_eyebrow:!1},n=this.appContext.getViewer().signedIn;return e.isJobs?t.small_logo=!0:e.isPlayr?t.use_uh_eyebrow=!1:e.isEditr?(t.small_logo=!0,t.you_link=!0,t.chronic_link=!0,t.editr_tour_link=!0,t.account_menu=!0,t.use_uh_eyebrow=!1):e.isHome&&!n?(t.tour_link=!0,t.signup_link=!0,t.explore_menu=!0,t.upload_link=!0,t.nav_selecta=!0,t.signin_link=!0):n?(t.you_menu=!0,t.contacts_menu=!0,t.groups_menu=!0,t.explore_menu=!0,t.upload_link=!0,t.nav_selecta=!0,t.account_menu=!0):(t.tour_link=!0,t.signup_link=!0,t.explore_menu=!0,t.upload_link=!0,t.nav_selecta=!0,t.signin_link=!0),t},generateViewerUrls:function(t){var n;return this.appContext.request?n=this.appContext.request.normalizedProtocol+"://"+this.appContext.request.get("host"):n=e.config.win.location.protocol+"//"+e.config.win.location.host,n+=t.getValue("url"),{photostream:n+"photostream",sets:n+"sets",map:n+"map",favorites:n+"favorites",galleries:n+"galleries",stats:n+"stats",creations:n+"creations",contacts:n+"contacts"}}})},"@VERSION@",{requires:["flickr-view","hermes-template-global-nav","global-nav-css"]});
YUI.add("photo-page-view",function(e){e.namespace("Views")[this.name]=e.Base.create("photo-page-view",e.FlickrView,[],{initializer:function(t){return this.showWelcomeDialog=t.showWelcomeDialog,this.closeUrl=t.closeUrl,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.realFullscreen=this.appContext.experiments.fullscreen.isRealFullscreen(),t.realFullscreen=this.realFullscreen,t.isOwner=this.isOwner,this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one("head title").set("text",t.title.newVal+" | Flickr - Photo Sharing!")})}),this},subviewConfig:{"photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-sidebar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()}},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return!this.appContext.getViewer().signedIn&&this.appContext.flipper.isFlipped("global-nav-enabled")&&e.push("has-global-nav"),e},buildContainer:function(){var t,n=this.subviews["photo-well-view"].get("container"),r,i,s=!1;return this.realFullscreen?this.appContext.experiments.fullscreen.getMode()?(r="",n.addClass("is-real-fullscreen"),s=!0):(r=this.subviews["photo-sidebar-view"].get("container"),YUI.Env.isServer||n.removeClass("is-real-fullscreen")):r=this.subviews["photo-sidebar-view"].get("container"),this.appContext.getViewer().signedIn||s?i="":this.appContext.flipper.isFlipped("global-nav-enabled")&&(i=this.subviews["global-nav-view"].get("container")),t=this.templates("photo-page")({"photo-well-view":n,"sidebar-view":r,"global-nav-view":i}),this.setContainerHTML(t),e.Fletrics.increment("test.photo.page.requests"),this},activate:function(){var t=this.get("container"),n,r,i=this,s=[];return this.showWelcomeDialog&&(r=this.templates("reboot-welcome-dialog-content")({"opt-out-enabled":this.appContext.experiments.optOut.enabled()}),this.appContext.experiments.optOut.enabled()&&s.push({buttonMarkup:new e.Handlebars.SafeString(this.templates("photo-opt-out")({"redirect-url":window.location.pathname}))}),n=e.Views.dialog.getNewInstance("dialog-cta",{attrs:{title:"Welcome to the beta of the new photo page!",confirmButtonText:"Take me to the new experience!",verticalButtonList:!0,additionalButtons:s},content:r,parent:this,rootEl:t}),setTimeout(function(){n.show()},100)),this.registerEventHandler(e.on("flickr:photo-sidebar-fullscreen-expand",function(){i.subviews["photo-well-view"].subviews["photo-well-media-view"].player&&(i.subviews["photo-well-view"].subviews["photo-well-media-view"].player.destroy(),i.subviews["photo-well-view"].subviews["photo-well-media-view"].player=null),i.appContext.experiments.fullscreen.disableFullscreen(),i.instantiateSubview("photo-sidebar-view",i._params).then(function(e){return e.initialize()}).then(function(t){i.subviews["photo-well-view"].subviews["photo-sidebar-actions-view"].get("container").remove(!0),i.subviews["photo-well-view"].subviews["photo-sidebar-actions-view"].destroy(),i.buildContainer(),i.subviews["photo-well-view"].subviews["photo-sidebar-toggle-view"].buildContainer(),i.subviews["photo-well-view"].subviews["photo-sidebar-toggle-view"].activate(),i.subviews["photo-well-view"].setupFeedbackDropdown(),i.subviews["photo-well-view"].subviews["attribution-view"]&&i.subviews["photo-well-view"].subviews["attribution-view"].get("container").addClass("is-always-hidden"),i.subviews["photo-sidebar-view"].activate(),i.subviews["photo-sidebar-view"].recursivelyActivateSubviews(),e.fire("flickr:photo-media-well-update"),i.appContext.flipper.isFlipped("scrollbar")&&i.enableScrollbarFix()})})),this.registerEventHandler(e.on("flickr:photo-sidebar-fullscreen-collapse",function(){i.appContext.flipper.isFlipped("scrollbar")&&i.disableScrollbarFix(),i.subviews["photo-well-view"].subviews["photo-well-media-view"].player&&(i.subviews["photo-well-view"].subviews["photo-well-media-view"].player.destroy(),i.subviews["photo-well-view"].subviews["photo-well-media-view"].player=null),i.appContext.experiments.fullscreen.enableFullscreen(),i.subviews["photo-well-view"].instantiateSubview("photo-sidebar-actions-view",i.subviews["photo-well-view"]._params).then(function(e){return e.initialize()}).then(function(t){i.subviews["photo-sidebar-view"].destroy(),i.buildContainer(),i.subviews["photo-well-view"].subviews["photo-sidebar-toggle-view"].buildContainer(),i.subviews["photo-well-view"].subviews["photo-sidebar-toggle-view"].activate(),i.subviews["photo-well-view"].setupFeedbackDropdown(),t.get("container").addClass("is-real-fullscreen"),i.subviews["photo-well-view"].get("container").append(t.get("container")),t.activate(),t.recursivelyActivateSubviews(),i.subviews["photo-well-view"].subviews["attribution-view"]&&(i.subviews["photo-well-view"].subviews["attribution-view"].buildContainer(),i.subviews["photo-well-view"].subviews["attribution-view"].get("container").removeClass("is-always-hidden"),i.subviews["photo-well-view"].subviews["attribution-view"].activate()),e.fire("flickr:photo-media-well-update")}).then(null,function(e){throw e})})),this.appContext.flipper.isFlipped("scrollbar")&&this.subviews["photo-sidebar-view"]&&this.enableScrollbarFix(),this.appContext.adManager.isEnabled()&&(this.appContext.adManager.updatePhotoAdsCounter(),this.appContext.adManager.fetchAdIfRequired()),this.attachKeyEvent("up:27",this.closeDialog.bind(this)),this.appContext.flipper.isFlipped("shortcut-legend")&&(this.attachKeyEvent("down:191",this.showKeyboardLegend.bind(this)),e.on("flickr:photo-page:hideKeyboardLegend",function(){i.keyboardLegend.isVisible()&&(i.keyboardLegend.hide(),i.keyboardLegendDialogView.destroy()
,i.keyboardLegend.destroy())})),this},showKeyboardLegend:function(t){var n,r=new e.Views["keyboard-legend-view"]({});r.appContext=this.appContext,r.buildContainer(),n=r.get("container"),this.keyboardLegend=e.Views.dialog.getNewInstance("dialog-modal",{content:n,appContext:this.appContext}),this.keyboardLegend.show(),r._params.keyEventScope=this.keyboardLegend.getKeyEventScope(),r.activate(),this.keyboardLegendDialogView=r},closeDialog:function(t){e.config.win.location.href=this.closeUrl},enableScrollbarFix:function(){var t,n,r,i,s=this,o;this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()?o=0:o=e.OverflowHelper.detectScrollbarSize(this.get("container")),o>0&&(t=this.get("container").ancestor("#content"),n=this.subviews["photo-sidebar-view"].get("container"),r=this.subviews["photo-well-view"].get("container"),i=parseInt(n.getStyle("maxWidth").replace("px",""),10),e.OverflowHelper.addFlowListener(t,"over",function(){if(this.offsetWidth>this.clientWidth||this.offsetHeight>this.clientHeight)n.setStyle("maxWidth",i),n.setStyle("overflow","visible")},function(e){s.overflowEventHandler=e,s.registerEventHandler(e)}),e.OverflowHelper.addFlowListener(t,"under",function(){this.offsetWidth===this.clientWidth&&(n.setStyle("maxWidth",i+o+1),n.setStyle("overflow","visible"))},function(e){s.underflowEventHandler=e,s.registerEventHandler(e)}),n.setStyle("overflow","hidden"),this.scrollTimeout=setTimeout(function(){n&&n._node&&n.setStyle("overflow","visible")},1e3),t.setStyle("overflow","auto"),t._node.offsetWidth<=t._node.clientWidth&&n.setStyle("maxWidth",i+o),n.one(".closeBtn, .newCloseBtn").setStyle("right",o+10),r.setStyle("right",parseInt(r.getStyle("right").replace("px",""),10)+o),e.fire("flickr:photo-media-well-update"))},disableScrollbarFix:function(){var t=e.OverflowHelper.detectScrollbarSize(this.get("container")),n;t>0&&(this.overflowEventHandler&&this.overflowEventHandler.detach(),this.underflowEventHandler&&this.underflowEventHandler.detach(),n=this.subviews["photo-well-view"].get("container"),n.setStyle("right",""))},buildHeadContainer:function(){var e=this.subviews["photo-head-meta-view"].get("headContainer");return this.set("headContainer",e),this},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0,fullScrn:this.appContext.experiments.fullscreen.getMode()?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)}},{ATTRS:{spaceid:{value:792600506}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page","photo-css","util-css","fletrics","ttfp-recorder-plugin","signin-helper","dialog","overflow-helper","hermes-template-reboot-welcome-dialog-content","hermes-template-photo-opt-out","keyboard-legend-view"],optional:["photo-well-view","photo-sidebar-view","photo-head-meta-view","global-nav-view"]});
YUI.add("photo-route",function(e){function t(e){t.superclass.constructor.call(this,e)}t.entryPaths={accept:[/^\/$/,/^\/photos\/[^\/]+\/?$/,/^\/photos\/[^\/]+\/sets\//,/^\/photos\/[^\/]+\/friends\/?/,/^\/photos\/[^\/]+\/favorites\/?/,/^\/photos\/[^\/]+\/galleries\/?/,/^\/people\/[^\/]+\//,/^\/explore\/?/,/^\/commons\/?/,/^\/groups\/?/,/^\/galleries\/?/,/^\/map\/?/,/^\/search\/?/],ignore:[/^\/photos\/[^\/]+\/\d+\/in\//,/^\/photos\/[^\/]+\/\d+\/?$/]},e.Routes[this.name]=t,e.extend(t,e.FlickrRoute,{run:function(t){var n=this,r=t.params[0],i=t.params[3],s=t.params[4],o={id:i},u="welcome"in t.query;return e.TypeValidator.matches.nsid(r)?o.userId=r:o.pathAlias=r,this.appContext.getModel("photo-models",o).then(function(i){var o,a,f,l,c,h;o=n.verifyPhotoIsViewable(i,t),h=n.detectRouteErrors(o);if(h.length)return n.displayRouteErrors(t,h);a=n.verifyPhotoIsOwnedByPerson(i,r),h=n.detectRouteErrors(a);if(h.length)return n.displayRouteErrors(t,h);c=n.verifyContext(s,i),n.detectPointOfEntry(t,{defaultEntryPath:"/photos/"+r+"/with/"+o}),t.url.match(/\/in\//)||(c=n.verifyContext("photostream",i));if(h.length)return n.displayRouteErrors(t,h);if(n.appContext.adManager.isEnabled()&&n.appContext.adManager.adNext()){l=n.appContext.adManager.getAdJSON();if(l&&e.Lang.isObject(l))return f=l.brand||"",{view:"photo-page-ad-view",params:{ad:!0,photoId:o,nsid:a,context:c},title:f};n.appContext.fatal("Could not extract brand name from brand payload",{ad:l})}return{view:"photo-page-view",params:{photoId:o,nsid:a,context:c,showWelcomeDialog:u,closeUrl:n.getEntryPath()},title:i.getValue("title")||"Untitled"}},function(r){return r.fatal?n.displayRouteErrors(t,new e.RouteError(500,"Couldn't load photo page")):n.displayRouteErrors(t,new e.RouteError(404,"Couldn't load photo page"))})},verifyPhotoIsViewable:function(t,n){var r=t.getValue("id"),i,s;return e.TypeValidator.matches.photoId(r)?(i="photo_privacy_is_viewable"in n.query?Number(n.query.photo_privacy_is_viewable):!0,s="photo_content_is_safe"in n.query?Number(n.query.photo_content_is_safe):!0,i?s?r:new e.RouteError(404,"Photo is unfit for your eyes. Have a kitten: (^._.^)\uff89"):new e.RouteError(403,"Private photo")):new e.RouteError(404,"No photo found with id "+r)},verifyPhotoIsOwnedByPerson:function(t,n){var r=t.getValue("id"),i=e.TypeValidator.matches.nsid(n);return n===t.getValue("owner").getValue(i?"id":"pathAlias")?t.getValue("owner").getValue("id"):new e.RouteError(404,"Photo "+r+" is not owned by "+n)},verifyContext:function(t,n){var r;return t=t||"photostream",r=e.URLHelper.parseContextURL(t,n,this.appContext),r},detectPointOfEntry:function(n,r){var i,s,o,u,a,f=t.entryPaths;if(e.config.flickr.homerun&&(e.config.flickr.ycParam||n.query&&n.query.yc)){a=e.config.flickr.ycParam?e.config.flickr.ycParam:n.query.yc;if(e.config.flickr.homerun.yc.indexOf(a.replace(/https?\:\/\//,""))!==-1){a.match(/http/)?this.setEntryPath(a):this.setEntryPath("http://"+a);return}}YUI.Env.isServer?i=n.headers.referrer||n.headers.referer:(i=document.referrer,e.UA.ie&&document.referrer===""&&(i=this.appContext.referrer)),/^https?:\/\/(www\.)?flickr\.com/.test(i)||(i=null),u=i?"/"+i.split(/\//).slice(3).join("/"):"",this.getEntryPath()||this.setEntryPath(r.defaultEntryPath||"/");for(s=0,o=f.ignore.length;s<o;s++)if(f.ignore[s].test(u))return;for(s=0,o=f.accept.length;s<o;s++)if(f.accept[s].test(u))return this.setEntryPath(u)},setEntryPath:function(e){if(YUI.Env.isServer)return this._entryPath=e;t._entryPath=e},getEntryPath:function(){return YUI.Env.isServer?this._entryPath:t._entryPath}})},"@VERSION@",{requires:["flickr-route","type-validator","url-helper"],optional:["photo-models","photo-page-view"]});
YUI.add("photo-well-view",function(e){var t=1,n=5;e.namespace("Views")[this.name]=e.Base.create("photo-well-view",e.FlickrView,[],{initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.isAd=!!t.ad,this.firstLoad=!!t.firstLoad,this.get("container").html===""&&this.setContainerHTML(""),this},subviewConfig:{"photo-well-media-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-sidebar-toggle-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.experiments.fullscreen.showFullscreenToggle()}},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen"],disabled:function(){return!this.appContext.experiments.fullscreen.showAttributionOverlay()}},"photo-sidebar-actions-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen"],disabled:function(){return this.appContext.experiments.fullscreen.disableRealFullscreenButtons()}},"people-notes-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("notes-and-people-ui")}}},buildContainer:function(){var e,t="";return!this.firstLoad&&this.appContext.experiments.fullscreen.isRealFullscreen()&&(this.subviews["photo-sidebar-actions-view"]&&this.subviews["photo-sidebar-actions-view"].get("container").addClass("is-hidden"),this.subviews["photo-sidebar-toggle-view"]&&this.subviews["photo-sidebar-toggle-view"].get("container").addClass("is-hidden")),this.appContext.experiments.fullscreen.isRealFullscreen()&&(this.appContext.experiments.fullscreen.getMode()?this.subviews["attribution-view"]&&(YUI.Env.isServer||this.subviews["attribution-view"].get("container").removeClass("is-always-hidden"),!this.firstLoad&&this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&this.subviews["attribution-view"].get("container").addClass("is-hidden"),t=this.subviews["attribution-view"].get("container")):this.subviews["attribution-view"]&&(this.subviews["attribution-view"].get("container").addClass("is-always-hidden"),t=this.subviews["attribution-view"].get("container"))),e=this.templates("photo-well")({"photo-well-media-view":this.subviews["photo-well-media-view"].get("container"),"is-video":this.get("photo").getValue("isVideo")&&this.appContext.flipper.isFlipped("yep-video"),"is-hidden":YUI.Env.isServer||!this.firstLoad,"is-ad":this.isAd,"photo-sidebar-toggle-view":this.subviews["photo-sidebar-toggle-view"]?this.subviews["photo-sidebar-toggle-view"].get("container"):"","opt-out-enabled":this.appContext.experiments.optOut.enabled(),"photo-sidebar-actions-view":this.subviews["photo-sidebar-actions-view"]?this.subviews["photo-sidebar-actions-view"].get("container"):"","attribution-view":t,"people-notes-view":this.subviews["people-notes-view"]?this.subviews["people-notes-view"].get("container"):""}),this.setContainerHTML(e),this},loadState:function(){var t=this;return e.batch(t.appContext.getModel("photo-models",t.photoId)).then(function(e){t.set("photo",e[0])})},setLinkAsAdFriendly:function(e){var t=e.currentTarget;t.hasClass("navigate-next")?this.appContext.adManager.setAdCouldBeShown(!0,"next",t.getAttribute("href")):this.appContext.adManager.setAdCouldBeShown(!0,"previous",t.getAttribute("href"))},animateNavigation:function(){var t=e.all(".navigate-target"),n=this.get("container"),r=n.one(".photo-sidebar-toggle-view"),i=n.one(".attribution-view"),s=1500,o=250,u=!1,a=!1,f,l=!0,c=this;this.appContext.experiments.fullscreen.isRealFullscreen()&&(s=(s-500)/2,u=!0,a=this.appContext.experiments.fullscreen.getMode()),this.registerEventHandler(this.get("container").on("mousemove",e.betterThrottle(function(e){f=n.one(".photo-sidebar-actions-view"),t&&l&&t.removeClass("is-hidden"),u&&l&&(f&&f.removeClass("is-hidden"),r&&r.removeClass("is-hidden"),i&&i.removeClass("is-hidden")),clearTimeout(c.movingTimeout),clearTimeout(c.initialTimeout),l=!0,c.movingTimeout=setTimeout(function(){f=n.one(".photo-sidebar-actions-view"),t&&t.addClass("is-hidden"),u&&(f&&f.addClass("is-hidden"),r&&r.addClass("is-hidden"),i&&i.addClass("is-hidden"))},s*2)},o))),!this.firstLoad&&this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&(l=!1),c.initialTimeout=setTimeout(function(){l=!0,f=n.one(".photo-sidebar-actions-view"),t&&c.firstLoad&&t.addClass("is-hidden"),u&&l&&(f&&f.addClass("is-hidden"),r&&r.addClass("is-hidden"),i&&i.addClass("is-hidden"))},s*2)},activate:function(){var r=this,i=this.contextData,s=this.get("container"),o=0,u,a,f,l,c=".navigate-prev",h=".navigate-next";return YUI.Env.isServer||(a=e.getLocation(),f=a.protocol,l=a.hostname,r.appContext.getModel(i.modelName,i.params).then(function(e){r.set("contextModel",e)}).then(function(){var t=r.get("contextModel").getValue("photoContextList"),n=t.getList(),s,u,a,p,d;return n.length>2&&n.some(function(e){return o++,e.getValue("id")===r.photoId})&&(u=n.slice(o-2,o-1),a=n.slice(o,o+1),u&&u.length>0&&(p=r.setupNavLink(u[0],c,"previous"),p&&(r.updateNavLinks(r.get("container").one(c),f,l,p),r.get("container").one(c).removeClass("no-click"))),a&&a.length>0&&(d=r.setupNavLink(a[0],h,"next"),d&&(r.updateNavLinks(r.get("container").one(h),f,l,d),r.get("container").one(h).removeClass("no-click")))),s=e.merge(i.params,{photoId:r.photoId,numNext:10,numPrev:10}),t.getContext(s)}).then(function(e){function i(i,s){var o=r.get("container").one(i),u,a,c,h,p,d,v=e&&e[s]&&e[s].length;if(!o)return;if(!v){o.remove();return}o.removeClass("no-click"),u=r.setupNavLink(e[s][0],i,s);if(r.isAd)c=r.appContext.adManager.origin,s===c.arrow?(o.setAttribute("href",c.url),o.removeClass("is-hidden")):(o.setAttribute("href",u),o.removeClass("is-hidden"));else{r.updateNavLinks(o,f,l,u),a=r.subviews["photo-well-media-view"].getCanvasSize();for(d=0;d<n;d++){if(!e[s][d])break;h=e[s][d].getSizeToFit(a,{includeSizes:["sq","q","t","s","n"]}),h&&
h.url&&(p=new Image,p.src=h.url)}for(d=0;d<t;d++){if(!e[s][d])break;h=e[s][d].getSizeToFit(a),h&&h.url&&(p=new Image,p.src=h.url)}}}r.appContext.adManager.updateContext({prev:e.previous[0],current:r.get("photo"),next:e.next[0],type:r.contextData.modelName}),i(h,"next"),i(c,"previous"),r.animateNavigation(),r.isAd&&r.appContext.adManager.markAdAsSeen()}).then(null,function(e){r.appContext.warn("There was a problem initializing the next/previous controls.",e&&e.message?e.message:e,e&&e.stack?e.stack:"")}),this.attachKeyEvent("down:37,75,39,74",r.handlePrevNextKeys.bind(r)),this.get("photo").getValue("isOwner")||this.appContext.getViewCounter().queue(this.get("photo").getValue("id"))),s&&s.one(".feedback-widget button")&&(this.registerEventHandler(s.one(".feedback-widget button").on("mousedown",r.handleFeedbackClick,r)),this.setupFeedbackDropdown(),e.Env.isServer||s.all("input[name=redirect_url]").setAttribute("value",window.location.pathname)),u={":ad":r.setLinkAsAdFriendly},r.attachEvents(u),this},setupNavLink:function(t,n,r){var i=this.get("container").one(n),s,o;if(!t){i.remove();return}s=t,o=e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextModel").getValue("urlSuffix")});if(!o||o==="#"){this.appContext.warn("[photo-well-view] Invalid next/prev URL:",o),i.remove();return}return o},updateNavLinks:function(e,t,n,r){e.setAttribute("href",t+"//"+n+r),this.firstLoad&&e.removeClass("is-hidden")},destructor:function(){clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout),this.movingTimeout=null,this.initialTimeout=null},setupFeedbackDropdown:function(){var t=this.get("container"),n,r,i;if(this.appContext.flipper.isFlipped("buckets"))switch(this.appContext.buckets.photo_page){case"bucket1":i="https://yahoo.uservoice.com/forums/230780-flickr-photo-page-beta/";break;case"bucket2":i="https://yahoo.uservoice.com/forums/230781-flickr-photo-page-beta-2/";break;case"bucket3":i="https://yahoo.uservoice.com/forums/230782-flickr-photo-page-beta-3/";break;case"bucket4":i="https://yahoo.uservoice.com/forums/230783-flickr-photo-page-beta-4/";break;case"bucket5":i="https://yahoo.uservoice.com/forums/230785-flickr-photo-page-beta-5";break;case"bucket6":i="https://yahoo.uservoice.com/forums/230786-flickr-photo-page-beta-6";break;case"bucket7":i="https://yahoo.uservoice.com/forums/230787-flickr-photo-page-beta-7/";break;case"bucket8":i="https://yahoo.uservoice.com/forums/230788-flickr-photo-page-beta-8/";break;default:i="https://yahoo.uservoice.com/forums/224533-flickr-photo-page-beta"}else i="https://yahoo.uservoice.com/forums/224533-flickr-photo-page-beta";r=[{buttonMarkup:new e.Handlebars.SafeString('<a href="'+i+'" data-track="helpFeedbackUserVoiceClick" class="ui-button" target="_blank"><span>Feedback</span></a>')},{buttonMarkup:new e.Handlebars.SafeString('<a href="http://www.flickr.com/help/photos/#167391143" data-track="helpFeedbackFAQClick" class="ui-button" target="_blank"><span>FAQs</span></a>')}],n=this.templates("reboot-welcome-dialog-content")({"opt-out-enabled":this.appContext.experiments.optOut.enabled()}),this.appContext.experiments.optOut.enabled()&&r.push({buttonMarkup:new e.Handlebars.SafeString(this.templates("photo-opt-out")({"redirect-url":window.location.pathname}))}),this.feedbackDialog=e.Views.dialog.getNewInstance("dialog-cta",{attrs:{title:"Welcome to the beta of the new photo page!",hideConfirmButton:!0,verticalButtonList:!0,additionalButtons:r},content:n,parent:this,rootEl:t.ancestor()})},handleFeedbackClick:function(t){if(t.target.ancestor(".ui-dialog",!0))return;t.halt(),this.feedbackDialog.toggle(),e.rapidTracker.beacon(this.name,"helpFeedbackMenuClick")},handlePrevNextKeys:function(t){var n=this,r,i,s,o=50;if(t.button===37||t.button===75)i=".navigate-prev",s="previous",e.rapidTracker.beacon(this.name,"prevPhotoKeyPress");else if(t.button===39||t.button===74)i=".navigate-next",s="next",e.rapidTracker.beacon(this.name,"nextPhotoKeyPress");i&&n.get("container").one(i)&&(t.preventDefault(),r=n.get("container").one(i).getAttribute("href"),r&&r!=="#"&&(n.keyboardNavigation&&n.keyboardNavigation.url&&r===n.keyboardNavigation.url&&(new Date).getTime()-n.keyboardNavigation.time<o?n.appContext.debug("[photo-well-view] Ignoring duplicate keyboard navigation within "+o+"ms",r):(n.keyboardNavigation={url:r,time:(new Date).getTime()},this.appContext.adManager.setAdCouldBeShown(!0,s,r),n.appContext.flapp.navigate(r))))}})},"@VERSION@",{requires:["yui-throttle","flickr-view","hermes-template-photo-well","photo-well-css","url-helper","better-throttle","hermes-template-reboot-welcome-dialog-content","hermes-template-photo-opt-out"],optional:["photo-well-media-view","photo-models","photo-route"]});
YUI.add("photo-head-meta-view",function(e){e.namespace("Views")[this.name]=e.Base.create("photo-head-meta-view",e.FlickrView,[],{initializer:function(e){return this.photoId=e.photoId,this},subviewConfig:{},buildContainer:function(){return this},loadState:function(){var t=this;return e.batch(t.appContext.getModel("photo-head-meta-models",t.photoId),t.appContext.getModel("photo-models",t.photoId)).then(function(e){t.set("photo-meta",e[0]),t.set("photo",e[1])})},buildHeadContainer:function(){var e=this.get("photo-meta"),t=this.get("photo"),n="http://www.flickr.com",r=e.getFieldsForDisplay(),i="",s=this,o=[{id:"canonicalurl",rel:"canonical",href:n+t.getValue("url")},{rel:"alternative",type:"application/json+oembed",href:n+"/services/oembed?url="+encodeURI(t.getValue("url"))+"&format=json",title:t.getValue("title")},{rel:"alternative",type:"text/xml+oembed",href:n+"/services/oembed?url="+encodeURI(t.getValue("url"))+"&format=xml",title:t.getValue("title")}];return Object.keys(r).forEach(function(e){typeof r[e]=="object"&&e==="pinterest"?i+=s.templates("head-meta")({metaName:e,noPin:!0,metaValue:r[e].nopin,metaDescription:r[e].reason})+"\n":i+=s.templates("head-meta")({metaName:e,metaValue:r[e]})+"\n"}),o.forEach(function(e){e.addedBy=s.name,i+=s.templates("head-link")(e)+"\n"}),this.set("headContainer",i),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-head-meta","hermes-template-head-link"],optional:["photo-head-meta-models","photo-route"]});
YUI.add("photo-privacy-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r;return r={photo_id:t,is_public:this.getValue(t,"isPublic"),is_friend:this.getValue(t,"isVisibleByFriends"),is_family:this.getValue(t,"isVisibleByFamily"),perm_addmeta:this.getValue(t,"permAddMeta"),perm_comment:this.getValue(t,"permComment")},e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)}},attributes:{isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},permAddMeta:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},permComment:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getPerms-fetcher","flickr-photos-setPerms-updater","attribute-helpers"]});
YUI.add("flickr-photos-getPerms-fetcher",function(e){"use strict";function t(e,t){var n=e[0],r=e[1],i;i={id:t.id,isPublic:n.perms.ispublic,isVisibleByFriends:n.perms.isfriend,isVisibleByFamily:n.perms.isfamily,permAddMeta:n.perms.permaddmeta,permComment:n.perms.permcomment},r.exists(t.id)||r.add(i)}function n(t,n){var r=t.id,i={photo_id:r},s=this;return e.batch(n.callAPI("flickr.photos.getPerms",i),n.getModelRegistry("photo-privacy-models")).then(function(e){return s._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-getPerms-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:n,_processResponse:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]});
YUI.add("photo-contexts-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)}},getContextsOfType:function(t,n){return n=e.Array(n),this.getValue(t,"contexts").getList().filter(function(e){return n.indexOf(e.registry.name)>-1})},getContextsNotOfType:function(t,n){return n=e.Array(n),this.getValue(t,"contexts").getList().filter(function(e){return n.indexOf(e.registry.name)===-1})},attributes:{contexts:{isCollection:!0},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/explore":undefined}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher"]});
YUI.add("favorite-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-favorites-getList"].run(t,this.appContext)}},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"favorites"}},title:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.appContext.getViewer(),n;return t&&t.nsid===e?"Your favorites":(n=this.getValue(e,"owner"),n?n.getValue("displayname")+"'s favorites":"Favorites")}},pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return e}},owner:{isModel:!0},photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-favorites-getList"]}},photoContextList:{isCollection:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-favorites-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=t?t.getValue("pathAlias"):e;return"/photos/"+n+"/favorites/"}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=t.getValue("pathAlias");return"faves-"+n}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-favorites-getContext-fetcher","flickr-favorites-getList-fetcher"]});
YUI.add("flickr-favorites-getContext-fetcher",function(e){"use strict";function t(t){var n={photo_id:t.photoId,num_prev:t.numNext,num_next:t.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()};return t.id?n.user_id=t.id:n.path_alias=t.pathAlias,n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=[],a=[],f=s.proxy(n.photoId),l,c,h,p,d,v,m=[];return l=r.prevphotos,c=r.nextphotos,a=e.APIHelper.response.parsePhotos({photos:l.photo,personModelRegistry:o,photoModelRegistry:s}),u=e.APIHelper.response.parsePhotos({photos:c.photo,personModelRegistry:o,photoModelRegistry:s}),v=i.getValue(n.id,"photoContextList"),p=v.hasMinBoundary?v.hasMinBoundary():!1,d=v.hasMaxBoundary?v.hasMaxBoundary():!1,h=v.getList(),m=e.APIHelper.response.addOrReplaceListByContext({model:f,next:a,prev:u.reverse(),hasMax:d,hasMin:p,current:h,numNext:n.numNext,numPrev:n.numPrev}),i.setValue(n.id,"photoContextList",m),{next:a,previous:u.reverse()}}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.favorites.getContext",this._processParams(t),!0),n.getModelRegistry("favorite-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-favorites-getContext-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-favorites-getContext"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper","type-validator"],optional:["favorite-models","photo-models","person-models"]});
YUI.add("flickr-favorites-getList-fetcher",function(e){"use strict";function t(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||20,page:t.page||1,get_user_info:1};if(t.id)n.user_id=t.id;else{if(!t.pathAlias)throw new Error("[flickr-favorites-getList-fetcher] `id` or `pathAlias` is required.");n.path_alias=t.pathAlias}return n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u={id:r.user.nsid,pathAlias:r.user.pathAlias};return u.owner=e.APIHelper.response.parsePerson(r.user),s.exists(u.owner.id)||s.add(u.owner),u.owner=s.proxy(u.owner.id),u.photoPageList=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:s,photoModelRegistry:i}),o.exists(u.id)?o.setValue(u.id,"photoPageList",u.photoPageList):o.add(u),u.photoPageList}function r(t,n){var r=this,i=n.auth.signedIn?"flickr.favorites.getList":"flickr.favorites.getPublicList";return e.batch(n.callAPI(i,this._processParams(t)),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("favorite-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-favorites-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-favorites-getList"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","favorite-models"]});
YUI.add("flickr-galleries-addPhoto-creator",function(e){"use strict";function t(t,n){var r={},i=t.galleryCompoundID.split("-")[1];return r.photo_id=t.photoID,r.gallery_id=t.galleryCompoundID,e.batch(n.callAPI("flickr.galleries.addPhoto",r),n.getModel("gallery-models",i),n.getModel("photo-models",t.photoID)).then(function(e){var t=e[0],n=e[1],r=e[2];if(t.stat==="ok")return n.addPhoto(r),n},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-addPhoto-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-galleries-addPhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-galleries-removePhoto-deletor",function(e){"use strict";function t(t,n){var r={},i=t.galleryCompoundID.split("-")[1];return r.photo_id=t.photoID,r.gallery_id=t.galleryCompoundID,e.batch(n.callAPI("flickr.galleries.removePhoto",r),n.getModel("gallery-models",i),n.getModel("photo-models",t.photoID)).then(function(e){var t=e[0],n=e[1],r=e[2];if(t.stat==="ok")return n.removePhoto(r),n},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-removePhoto-deletor] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-galleries-removePhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-galleries-create-creator",function(e){"use strict";function t(t,n){var r={};return r.title=t.title,r.description=t.description,r.primary_photo_id=t.photoID,r.full_result=1,e.batch(n.callAPI("flickr.galleries.create",r),n.getModelRegistry("gallery-models"),n.getModel("photo-models",t.photoID),n.getModel("person-models",n.getViewer().nsid),n.getModel("person-galleries-models",n.getViewer().nsid)).then(function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o,u=t.gallery.id,a=u.split("-")[1];return a?(o=n.add({id:a,compoundId:u,title:t.gallery.title.content,description:t.gallery.description.content,photoPageList:[r],photoContextList:[r],owner:i,primary:{m:t.gallery.primary_photo_extras.urlM,s:t.gallery.primary_photo_extras.urlS,sq:t.gallery.primary_photo_extras.urlSq,t:t.gallery.primary_photo_extras.urlT}}),s.getValue("galleries").prependToList(o),o):!1},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-create-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-galleries-create"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("gallery-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getPhotos"].run(t,this.appContext)},create:function(t,n){return e.ModelCreators["flickr-galleries-create"].run(t,n)},addPhoto:function(t,n){return e.ModelCreators["flickr-galleries-addPhoto"].run(t,n)},removePhoto:function(t,n){return e.ModelCreators["flickr-galleries-removePhoto"].run(t,n)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},attributes:{compoundId:{validator:function(t,n){return e.Lang.isString(t)&&t.indexOf("-")>-1}},displayType:{readOnly:!0,defaultFn:function(){return"gallery"}},title:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){var n=e.AttributeHelpers.coerceString(t);return n=n.replace(/\\'/,"'").replace(/\\"/,'"').replace(/\\\\/,"\\"),n},defaultValue:""},description:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getPhotos"]}},photoContextList:{isCollection:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-galleries-getContext"],listItemIdField:"photoId"}},primary:{},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/galleries/"+e+"/":undefined}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=t.getValue("pathAlias");return"gallery-"+n+"-"+e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getPhotos-fetcher","flickr-galleries-getContext-fetcher","flickr-galleries-addPhoto-creator","flickr-galleries-removePhoto-deletor","flickr-galleries-create-creator"]});
