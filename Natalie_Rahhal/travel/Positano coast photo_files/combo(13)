YUI.add("hermes-template-photo-sidebar-toggle",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function a(e,t){return"fullscreen"}function f(e,t){return"&#10529;"}function l(e,t){return"&#10530;"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this;s+='<a class="toggle">\n	<span class="toggle-icon hide-text ',o=n["if"].call(t,t.isRealFullscreen,{hash:{},inverse:u.noop,fn:u.program(1,a,i),data:i});if(o||o===0)s+=o;s+='">',o=n["if"].call(t,t.isRealFullscreen,{hash:{},inverse:u.program(5,l,i),fn:u.program(3,f,i),data:i});if(o||o===0)s+=o;return s+="</span>\n</a>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-sidebar-toggle",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-sidebar-toggle-view",function(e){e.namespace("Views")[this.name]=e.Base.create("photo-sidebar-toggle-view",e.FlickrView,[],{initializer:function(e){return this.realFullscreen=!!e.realFullscreen,this},loadState:function(){return e.AutoResolvingPromise()},buildContainer:function(){var e,t=self.appContext.experiments.fullscreen.getMode();return e=this.templates("photo-sidebar-toggle")({isRealFullscreen:t}),this.get("container").addClass("show"),this.setContainerHTML(e),this},activate:function(){var t=this.get("container"),n=t.one(".toggle"),r=this;return t&&n&&this.registerEventHandler(n.on("click",function(){e.rapidTracker.beacon(this.name,"toggleFullscreenButtonClick"),r.realFullscreen&&r.appContext.experiments.fullscreen.getMode()?e.fire("flickr:photo-sidebar-fullscreen-expand"):e.fire("flickr:photo-sidebar-fullscreen-collapse")})),this},animateToggle:function(){var t=this.get("container"),n=1500,r=250,i,s;this.registerEventHandler(this.get("container").on("mousemove",e.betterThrottle(function(e){t.addClass("show"),clearTimeout(i),clearTimeout(s),i=setTimeout(function(){t.removeClass("show")},n*2)},r))),s=setTimeout(function(){t.removeClass("show")},n*2)}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-sidebar-toggle","promise","photo-sidebar-toggle-css"],optional:[]});
YUI.add("hermes-template-context-slider",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="wrapper clear-float">\n	<div class="slider">\n		<span class="nav nav-l">\n			<span class="hide-text">&larr;</span>\n		</span>\n		<a class="context-thumb emptyImage" href="" data-track="contextSliderPreviousPhotoClick">&nbsp;</a>\n\n		<a class="context-thumb middle currentImage" href="" data-track="contextSliderCurrentPhotoClick">&nbsp;</a>\n\n		<a class="context-thumb emptyImage" href="" data-track="contextSliderNextPhotoClick">&nbsp;</a>\n		<span class="nav nav-r">\n			<span class="hide-text">&rarr;</span>\n		</span>\n	</div> \n</div>'}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context-slider",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-context-image",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){var r="",i;return r+='\n\n	<a data-loaded="false" style="left:',(i=n.left)?i=i.call(e,{hash:{},data:t}):(i=e.left,i=typeof i===o?i.apply(e):i),r+=u(i)+';float:left;display:block;position:absolute;background-color:gray;height:40px;width:86px;border:1px solid transparent;" href="#">\n		\n	</a>\n\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t.images,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context-image",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-context-text",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='\n\n<span data-loaded="true" style="left:',(o=n.left)?o=o.call(t,{hash:{},data:i}):(o=t.left,o=typeof o===u?o.apply(t):o),s+=a(o)+';float:left;display:block;position:absolute;height:40px;width:86px;border:1px solid #ccc;" href="#">\n	',(o=n.text)?o=o.call(t,{hash:{},data:i}):(o=t.text,o=typeof o===u?o.apply(t):o),s+=a(o)+"\n</span>\n\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context-text",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("context-slider-view",function(e){e.namespace("Views")[this.name]=e.Base.create("context-slider-view",e.FlickrView,[],{initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.contextSliderContainer=".context-thumb",this.get("container").html===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=t.contextData,r=new e.FlickrPromise({photo:t.appContext.getModel("photo-models",t.photoId),context:t.appContext.getModel(n.modelName,n.params)});return r.then(function(e){t.set("photo",e.photo),t.set("contextModel",e.context)}).then(function(){var r=e.merge(n.params,{photoId:t.photoId,numNext:10,numPrev:10});return t.get("contextModel").getValue("photoContextList").getContext(r)}).then(function(e){t.imageSize=88,t.atEnd=!1,t.set("contextImages",e)}).then(null,function(e){t.appContext.warn("There was a problem loading the context slider data.",e&&e.message?e.message:e,e&&e.stack?e.stack:"")})},buildContainer:function(){var t=this,n=this.get("contextModel"),r=n?n.getValue("photoContextList"):null,i=r?r.getList():null,s,o,u=[],a=0,f=0,l=[],c=[],h=e.getLocation(),p=h.protocol,d=h.hostname;return s=this.templates("context-slider")(),this.setContainerHTML(s),n&&r&&i&&(i.some(function(e){return e.getValue("id")===t.photoId?!0:(f++,!1)}),i.length>1&&(l=i.slice(f-1,f),c=i.slice(f+1,f+2)),u=l.concat(i[f],c),o=t.get("container").one(".slider"),l.length===0?(a=1,this.atStart=!0,o.one(".nav-l").setStyle("display","none")):c.length===2&&(this.atEnd=!0,o.one(".nav-r").setStyle("display","none")),this.sliderCanvas={height:40,width:101},u.forEach(function(r,i){var s=e.URLHelper.getPhotoPage({photoId:r.getValue("id"),pathAlias:r.getValue("owner").getValue("pathAlias"),contextSuffix:n.getValue("urlSuffix")});t.setBackgroundImage(o.all(t.contextSliderContainer).item(i+a),r),o.all(t.contextSliderContainer).item(i+a).setAttribute("href",p+"//"+d+s),o.all(t.contextSliderContainer).item(i+a).setAttribute("title",r.getValue("title")),o.all(t.contextSliderContainer).item(i+a).removeClass("emptyImage")})),this},activate:function(){var e=this,t=this.get("contextModel");return e.buildContainer(),e.createContextSlider(this.get("contextImages"),t.params,4,4),this},createContextSlider:function(t,n,r,i){var s=this;this.sliderId=this.photoId,this.registerEventHandler(this.get("container").one(".nav-l").on("click",function(){e.rapidTracker.beacon(s.name,"contextSliderMoveLeftClick"),s.moveContextLeft(n)})),this.registerEventHandler(this.get("container").one(".nav-r").on("click",function(){e.rapidTracker.beacon(s.name,"contextSliderMoveRightClick"),s.moveContextRight(n)})),this.registerEventHandler(this.get("container").one(".slider").all(this.contextSliderContainer).on("click",function(t){var n=t.target.getAttribute("href");e.rapidTracker.beacon(s.name,t.target.getAttribute("data-track"));if(n==="#"||n==="")t.preventDefault(),t.stopPropagation()})),this.attachKeyEvent("down:188,190",this.handlePrevNextKeys.bind(this)),setTimeout(function(){s.get("container").one(".wrapper").addClass("is-ready")},10)},moveContextLeft:function(t){var n=this.get("container"),r=n.one(".slider"),i=this.get("contextModel").getValue("photoContextList"),s=i.getList(),o,u,a,f,l,c,h,p=this.get("contextModel"),d,v=0,m=this;if(i.hasMinBoundary()&&s[0].getValue("id")===m.sliderId){r.one(".nav-l").setStyle("display","none");return}r.one(".nav-r").setStyle("display","block"),i.hasMinBoundary()&&s[1].getValue("id")===m.sliderId?r.one(".nav-l").setStyle("display","none"):r.one(".nav-l").setStyle("display","block"),this.atEnd=!1,r.all(this.contextSliderContainer).item(0).removeClass("emptyImage"),a=r.all(this.contextSliderContainer).item(1).getStyle("backgroundImage"),u=r.all(this.contextSliderContainer).item(0).getStyle("backgroundImage"),l=r.all(this.contextSliderContainer).item(1).getAttribute("title"),f=r.all(this.contextSliderContainer).item(0).getAttribute("title"),h=r.all(this.contextSliderContainer).item(1).getAttribute("href"),c=r.all(this.contextSliderContainer).item(0).getAttribute("href"),s.some(function(e){return e.getValue("id")===m.sliderId?!0:(v++,!1)}),this.sliderId===this.photoId?(r.all(this.contextSliderContainer).item(2).addClass("currentImage"),r.all(this.contextSliderContainer).item(1).removeClass("currentImage")):(r.all(this.contextSliderContainer).item(2).removeClass("currentImage"),r.all(this.contextSliderContainer).item(1).removeClass("currentImage")),r.all(this.contextSliderContainer).item(2).setStyle("backgroundImage",a).setAttribute("href",h).setAttribute("title",l),r.all(this.contextSliderContainer).item(1).setStyle("backgroundImage",u).setAttribute("href",c).setAttribute("title",f),v>0?(this.sliderId=s[v-1].getValue("id"),v-2>=0?(o=s[v-2],this.setBackgroundImage(r.all(this.contextSliderContainer).item(0),o),d=e.URLHelper.getPhotoPage({photoId:o.getValue("id"),pathAlias:o.getValue("owner").getValue("pathAlias"),contextSuffix:p.getValue("urlSuffix")}),r.all(this.contextSliderContainer).item(0).setAttribute("href",d).setAttribute("title",o.getValue("title"))):r.all(this.contextSliderContainer).item(0).setStyle("backgroundImage","").setAttribute("href","").setAttribute("title","").removeClass("restrictedImage").addClass("emptyImage"),this.sliderId===this.photoId?(r.all(this.contextSliderContainer).item(1).addClass("currentImage"),r.all(this.contextSliderContainer).item(0).removeClass("currentImage")):v-2>=0&&s[v-2].getValue("id")===this.photoId?(r.all(this.contextSliderContainer).item(0).addClass("currentImage"),r.all(this.contextSliderContainer).item(1).removeClass("currentImage")):(r.all(this.contextSliderContainer).item(1).removeClass("currentImage"),r.all(this.contextSliderContainer).item(0).removeClass("currentImage"))):r.all(this.contextSliderContainer).item(0).setStyle("backgroundImage","").setAttribute("href","").setAttribute("title","").removeClass("restrictedImage").addClass("emptyImage"),this.get("contextModel").getValue("photoContextList").getContext(e.merge(t,{
photoId:this.sliderId,numNext:0,numPrev:10})).then(function(t){t.previous.length>0?(m.atStart=!1,r.one(".nav-l").setStyle("display","block"),m.setBackgroundImage(r.all(this.contextSliderContainer).item(0),t.previous[0]),d=e.URLHelper.getPhotoPage({photoId:t.previous[0].getValue("id"),pathAlias:t.previous[0].getValue("owner").getValue("pathAlias"),contextSuffix:p.getValue("urlSuffix")}),r.all(this.contextSliderContainer).item(0).setAttribute("href",d).setAttribute("title",t.previous[0].getValue("title"))):m.atStart=!0})},moveContextRight:function(t){var n=this.get("container"),r=n.one(".slider"),i=this.get("contextModel").getValue("photoContextList"),s=i.getList(),o,u,a,f,l,c,h,p,d=this.get("contextModel"),v,m=0,g=!1;self=this;if(i.hasMaxBoundary()&&s.slice(-1)[0].getValue("id")===self.sliderId){r.one(".nav-r").setStyle("display","none");return}i.hasMaxBoundary()&&s.slice(-2)[0].getValue("id")===self.sliderId?r.one(".nav-r").setStyle("display","none"):r.one(".nav-r").setStyle("display","block"),r.one(".nav-l").setStyle("display","block"),this.atStart=!1,r.all(this.contextSliderContainer).item(2).removeClass("emptyImage"),a=r.all(this.contextSliderContainer).item(2).getStyle("backgroundImage"),u=r.all(this.contextSliderContainer).item(1).getStyle("backgroundImage"),h=r.all(this.contextSliderContainer).item(2).getAttribute("href"),c=r.all(this.contextSliderContainer).item(1).getAttribute("href"),f=r.all(this.contextSliderContainer).item(2).getAttribute("title"),l=r.all(this.contextSliderContainer).item(1).getAttribute("title"),s.some(function(e){return e.getValue("id")===self.sliderId?(g=!0,!1):(m++,g||!1)}),this.sliderId===this.photoId?(r.all(this.contextSliderContainer).item(0).addClass("currentImage"),r.all(this.contextSliderContainer).item(1).removeClass("currentImage")):(r.all(this.contextSliderContainer).item(0).removeClass("currentImage"),r.all(this.contextSliderContainer).item(1).removeClass("currentImage")),r.all(this.contextSliderContainer).item(1).setStyle("backgroundImage",a).setAttribute("href",h).setAttribute("title",f),r.all(this.contextSliderContainer).item(0).setStyle("backgroundImage",u).setAttribute("href",c).setAttribute("title",l),m<s.length?(this.sliderId=s[m].getValue("id"),m+1<s.length?(o=s[m+1],this.setBackgroundImage(r.all(this.contextSliderContainer).item(2),o),p=e.URLHelper.getPhotoPage({photoId:o.getValue("id"),pathAlias:o.getValue("owner").getValue("pathAlias"),contextSuffix:d.getValue("urlSuffix")}),r.all(this.contextSliderContainer).item(2).setAttribute("href",p).setAttribute("title",o.getValue("title"))):r.all(this.contextSliderContainer).item(2).setStyle("backgroundImage","").setAttribute("href","").setAttribute("title","").removeClass("restrictedImage").addClass("emptyImage"),s.length>m+1&&s[m+1].getValue("id")===this.photoId?r.all(this.contextSliderContainer).item(2).addClass("currentImage"):this.sliderId===this.photoId?(r.all(this.contextSliderContainer).item(1).addClass("currentImage"),r.all(this.contextSliderContainer).item(2).removeClass("currentImage")):r.all(this.contextSliderContainer).item(2).removeClass("currentImage")):r.all(this.contextSliderContainer).item(2).setStyle("backgroundImage","").setAttribute("href","").setAttribute("title","").removeClass("restrictedImage").addClass("emptyImage"),v=this.sliderId,this.get("contextModel").getValue("photoContextList").getContext(e.merge(t,{photoId:v,numNext:10,numPrev:0})).then(function(t){t.next.length>0?(self.atEnd=!1,r.one(".nav-r").setStyle("display","block"),self.setBackgroundImage(r.all(this.contextSliderContainer).item(2),t.next[0]),p=e.URLHelper.getPhotoPage({photoId:t.next[0].getValue("id"),pathAlias:t.next[0].getValue("owner").getValue("pathAlias"),contextSuffix:d.getValue("urlSuffix")}),r.all(self.contextSliderContainer).item(2).setAttribute("href",p).setAttribute("title",t.next[0].getValue("title"))):self.atEnd=!0})},handlePrevNextKeys:function(t){t.button===188?(e.rapidTracker.beacon(self.name,"contextSliderMoveLeftKeyPress"),this.moveContextLeft(this.contextData.params)):t.button===190&&(e.rapidTracker.beacon(self.name,"contextSliderMoveRightKeyPress"),this.moveContextRight(this.contextData.params))},setBackgroundImage:function(e,t){var n=t.getValue("needsInterstitial"),r,i,s;n?(e.setStyle("backgroundImage",""),e.addClass("restrictedImage")):(e.removeClass("restrictedImage"),i=this.appContext.getViewer().getPixelRatio(),r={width:this.sliderCanvas.width*i,height:this.sliderCanvas.height*i},s={cropToFit:!0,includeSizes:["sq","t","q","s","n"]},e.setStyle("backgroundImage","url('"+t.getSizeToFit(r,s).url+"')"))}})},"@VERSION@",{requires:["flickr-view","hermes-template-context-slider","hermes-template-context-image","hermes-template-context-text","context-slider-css"],optional:[]});
